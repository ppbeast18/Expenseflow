<!DOCTYPE html>
<html>
<head>
    <title>Transaction Visualization</title>
    <!-- Add to your <head>, include datalabels plugin -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        .background {
            background-color: #000000;
            width: 100%;
            height: 100%;
            padding-bottom: 25px;
        }
        .top {
            background-color: black;
            width: 100vw;
            height: 20vh;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 60px;
            box-sizing: border-box;
            flex-direction: row;
        }
        .top h1 {
            color: gold;
            margin: 0;
            line-height: 1.5;
        }
        .kpi-box {
            width: 250px;
            height: 130px;
            background-color: #1f1f1f;
            color: #fff;
            padding: 12px 15px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            text-align: center;
            font-family: 'Segoe UI', sans-serif;
        }
        .kpi-label {
            font-size: 30px;
            font-weight: bold;
            color: #ccc;
            margin-bottom: 5px;
        }
        .kpi-value {
            font-size: 36px;
            font-weight: bold;
            color: #ffcc00;
        }
        .charts-container {
            width: 100%;
            height: calc(80vh - 20px);
            margin: 10px auto 0;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            flex-wrap: nowrap;
            gap: 20px;
            padding: 0 20px;
            box-sizing: border-box;
        }
        .single-chart {
            background-color: #1f1f1f;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            flex: 1;
            min-width: 0;
            height: 100%;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
        }
        .single-chart h3 {
            text-align: center;
            color: gold;
            margin-bottom: 15px;
        }
        .bottom-chart {
            max-width: 1200px;
            margin: 40px auto 0;
            background-color: #1f1f1f;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            color: white;
            font-family: 'Segoe UI', sans-serif;
        }
        .bottom-chart h3 {
            text-align: center;
            color: gold;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="background">
        <div class="top">
            <div class="top-left">
                <h1>
                    &nbsp;&nbsp;Your Financial Flow, Laid Bare<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— Every Transaction Tracked
                </h1>
            </div>
            <div class="kpi-box">
                <div class="kpi-label">Debit Amount</div>
                <div class="kpi-value">₹{{ total_debit }}</div>
            </div>
            <div class="kpi-box">
                <div class="kpi-label">Credit Amount</div>
                <div class="kpi-value">₹{{ total_credit }}</div>
            </div>
            <div class="kpi-box">
                <div class="kpi-label">Total Amount</div>
                <div class="kpi-value">₹{{ total_sum }}</div>
            </div>
        </div>

        <!-- Pie charts row -->
        <div class="charts-container">
            <div class="single-chart">
                <h3>Debit Amount Distribution</h3>
                <canvas id="debitPieChart"></canvas>
            </div>
            <div class="single-chart">
                <h3>Category Predicted by Model</h3>
                <canvas id="categoryPieChart"></canvas>
            </div>
            <div class="single-chart">
                <h3>Credit Amount Distribution</h3>
                <canvas id="creditPieChart"></canvas>
            </div>
            
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Debit Amount Pie Chart Data
        const debitLabels = {{ debit_names | tojson }};
        const debitData = {{ debit_amounts | tojson }};

        const ctxDebit = document.getElementById('debitPieChart').getContext('2d');
        new Chart(ctxDebit, {
            type: 'pie',
            data: {
                labels: debitLabels,
                datasets: [{
                    data: debitData,
                    backgroundColor: [
                        '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
                        '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
                    ],
                    borderColor: '#1f1f1f',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'right' },
                    title: { display: false },
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold',
                            size: 14
                        },
                        formatter: function(value, context) {
                            return '₹' + value.toLocaleString();
                        },
                        anchor: 'center',
                        align: 'center',
                        offset: 0,
                        display: function(context) {
                            return context.parsed > 0;
                        }
                    }
                }
            }
        });

        // Credit Amount Pie Chart Data
        const creditLabels = {{ credit_names | tojson }};
        const creditData = {{ credit_amounts | tojson }};

        const ctxCredit = document.getElementById('creditPieChart').getContext('2d');
        new Chart(ctxCredit, {
            type: 'pie',
            data: {
                labels: creditLabels,
                datasets: [{
                    data: creditData,
                    backgroundColor: [
                        '#2ECC71', '#1ABC9C', '#3498DB', '#9B59B6', '#E74C3C',
                        '#F39C12', '#E67E22', '#95A5A6', '#34495E', '#16A085'
                    ],
                    borderColor: '#1f1f1f',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'right' },
                    title: { display: false },
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold',
                            size: 14
                        },
                        formatter: function(value, context) {
                            return '₹' + value.toLocaleString();
                        },
                        anchor: 'center',
                        align: 'center',
                        offset: 0,
                        display: function(context) {
                            return context.parsed > 0;
                        }
                    }
                }
            }
        });

        // Predicted Categories Pie Chart Data
        const categoryLabels = {{ category_names | tojson }};
        const categoryData = {{ category_amounts | tojson }};

        const ctxCategory = document.getElementById('categoryPieChart').getContext('2d');
        new Chart(ctxCategory, {
            type: 'pie',
            data: {
                labels: categoryLabels,
                datasets: [{
                    data: categoryData,
                    backgroundColor: [
                        '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3',
                        '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39'
                    ],
                    borderColor: '#1f1f1f',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'right' },
                    title: { display: false },
                    datalabels: {
                        color: '#fff',
                        font: {
                            weight: 'bold',
                            size: 14
                        },
                        formatter: function(value, context) {
                            return '₹' + value.toLocaleString();
                        },
                        anchor: 'center',
                        align: 'center',
                        offset: 0,
                        display: function(context) {
                            return context.parsed > 0;
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
